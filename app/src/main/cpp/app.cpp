/*
 * This source file was generated by the Gradle 'init' task
 */

#include <queue>
#include <memory>
#include <ctime>
#include <limits>
#include "Patient.h"
#include "PatientRecord.h"
#include "app.h"
#include "IntakeForm.h"

void displayQueue(std::priority_queue<PatientRecord, std::vector<PatientRecord>, PatientComparator> q) {
    std::cout << "\nðŸ“‹ Current Queue (Highest Priority First):\n";
    while (!q.empty()) {
        auto p = q.top().patient;
        p->displayInfo();
        q.pop();
    }
    std::cout << "------------------------------\n";
}


int main () {
    std::priority_queue<
        PatientRecord,
        std::vector<PatientRecord>,
        PatientComparator
    > erQueue;

    IntakeForm form;
    char more = 'y';
    while(true) {
        auto patient = form.collect();
        PatientRecord record(std::time(nullptr), patient);
        erQueue.push(record);

        displayQueue(erQueue);

        std::string line;
        std::cout << "Add another patient? (y/n): ";
        std::getline(std::cin, line);

        if (!line.empty()) {
            more = line[0];
        } else {
            more = 'n';
        }

        if (more != 'y' && more != 'Y') {
            break;
        }
    }

    return 0;
}
